{% extends "monitor/base.html" %}
{% load static %}

{% block title %}Detector de anomalías{% endblock title %}

{% block content %}

<div class="main-container">
    <!-- Header -->
    <div class="header-section">
        <h1 class="page-title">Grabadora de Audio</h1>
        <p class="page-subtitle">Graba tu audio cardíaco para análisis</p>
    </div>

    <!-- Mensajes -->
    <div id="errorMessage" class="alert alert-danger" style="display: none;" role="alert"></div>
    <div id="successMessage" class="alert alert-success" style="display: none;" role="alert"></div>

    <!-- Card principal de grabación -->
    <div class="recording-card">
        
        <!-- Botones de control -->
        <div class="control-buttons">
            <button id="startRecordingButton" class="btn btn-record btn-start">
                Comenzar Grabación
            </button>
            <button id="stopRecordingButton" class="btn btn-record btn-stop" disabled>
                Detener Grabación
            </button>
        </div>

        <!-- Timer -->
        <div class="timer-display">
            <div class="timer-label">Tiempo de grabación</div>
            <div class="timer-value" id="recordingTimer">00:00</div>
        </div>

        <!-- Indicador de volumen -->
        <div class="volume-section">
            <span class="volume-label">Nivel de Audio</span>
            <div id="volumeIndicator"></div>
        </div>

        <!-- Canvas de visualización -->
        <div class="visualization-container">
            <canvas id="audioCanvas" width="800" height="180"></canvas>
        </div>

    </div>

    <!-- Reproductor de audio (se muestra después de grabar) -->
    <div id="audioPlayerSection" style="display: none;">
        <div class="player-card">
            <h5 class="player-title">Escucha tu grabación</h5>
            <audio id="audioPlayer" controls></audio>
            <div class="player-buttons">
                <button id="uploadButton" class="btn btn-player btn-upload">
                    Subir Audio
                </button>
                <button id="discardButton" class="btn btn-player btn-discard">
                    Descartar
                </button>
            </div>
        </div>
    </div>

</div>

<!-- Loading Spinner -->
<div id="loadingSpinner" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 9999; justify-content: center; align-items: center; flex-direction: column;">
    <div class="spinner-border text-light" role="status" style="width: 70px; height: 70px;">
        <span class="visually-hidden">Loading...</span>
    </div>
    <div class="text-white mt-3 fs-5 loading-text" style="font-weight: 500;">Procesando...</div>
</div>

<!-- Scripts JavaScript -->
<script src="{% static 'monitor/js/main.js' %}" type="module"></script>

{% endblock %}